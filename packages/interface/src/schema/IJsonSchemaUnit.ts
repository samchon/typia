import { OpenApi } from "../openapi/OpenApi";
import { OpenApiV3 } from "../openapi/OpenApiV3";

/**
 * Single JSON schema unit for one TypeScript type.
 *
 * `IJsonSchemaUnit` is generated by `typia.json.schema<T>()`. Contains one
 * schema definition with its referenced components.
 *
 * @template Version OpenAPI version ("3.0" or "3.1")
 * @template Type Original TypeScript type
 * @author Jeongho Nam - https://github.com/samchon
 */
export type IJsonSchemaUnit<
  Version extends "3.0" | "3.1" = "3.1",
  Type = unknown,
> = Version extends "3.0"
  ? IJsonSchemaUnit.IV3_0<Type>
  : IJsonSchemaUnit.IV3_1<Type>;

export namespace IJsonSchemaUnit {
  /**
   * JSON Schema unit for OpenAPI v3.0.
   *
   * @template Type Original TypeScript type
   */
  export interface IV3_0<Type> {
    /** OpenAPI version. */
    version: "3.0";

    /** The JSON schema definition. */
    schema: OpenApiV3.IJsonSchema;

    /** Reusable schema components for `$ref` referencing. */
    components: OpenApiV3.IComponents;

    /**
     * Phantom property for TypeScript generic type preservation.
     *
     * This property exists only in the type system to preserve the `Type`
     * generic parameter. It is always `undefined` at runtime and should not
     * be accessed or used in application code.
     */
    __type?: Type | undefined;
  }

  /**
   * JSON Schema unit for OpenAPI v3.1.
   *
   * @template Type Original TypeScript type
   */
  export interface IV3_1<Type> {
    /** OpenAPI version. */
    version: "3.1";

    /** The JSON schema definition. */
    schema: OpenApi.IJsonSchema;

    /** Reusable schema components for `$ref` referencing. */
    components: OpenApi.IComponents;

    /**
     * Phantom property for TypeScript generic type preservation.
     *
     * This property exists only in the type system to preserve the `Type`
     * generic parameter. It is always `undefined` at runtime and should not
     * be accessed or used in application code.
     */
    __type?: Type | undefined;
  }
}
