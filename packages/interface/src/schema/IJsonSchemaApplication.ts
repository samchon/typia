import { OpenApi } from "../openapi/OpenApi";
import { OpenApiV3 } from "../openapi/OpenApiV3";

/**
 * JSON Schema application for TypeScript functions.
 *
 * `IJsonSchemaApplication` represents a collection of TypeScript functions
 * converted to JSON Schema format. Generated by `typia.json.application<App>()`
 * for OpenAPI document generation or LLM function calling.
 *
 * @template Version OpenAPI version ("3.0" or "3.1")
 * @template App Source application type
 * @author Jeongho Nam - https://github.com/samchon
 */
export interface IJsonSchemaApplication<
  Version extends "3.0" | "3.1" = "3.1",
  App extends any = object,
> {
  /** OpenAPI version. */
  version: Version;

  /** Shared schema components for `$ref` referencing. */
  components: IJsonSchemaApplication.IComponents<
    IJsonSchemaApplication.Schema<Version>
  >;

  /** Array of function schemas. */
  functions: IJsonSchemaApplication.IFunction<
    IJsonSchemaApplication.Schema<Version>
  >[];

  /**
   * Phantom property for TypeScript generic type preservation.
   *
   * This property exists only in the type system to preserve the `App`
   * generic parameter. It is always `undefined` at runtime and should not
   * be accessed or used in application code.
   */
  __application?: App | undefined;
}
export namespace IJsonSchemaApplication {
  /** Schema type based on OpenAPI version. */
  export type Schema<Version extends "3.0" | "3.1"> = Version extends "3.1"
    ? OpenApi.IJsonSchema
    : OpenApiV3.IJsonSchema;

  /**
   * Shared schema components.
   *
   * @template Schema JSON schema type
   */
  export interface IComponents<
    Schema extends OpenApi.IJsonSchema | OpenApiV3.IJsonSchema =
      OpenApi.IJsonSchema,
  > {
    /** Named schema definitions for `$ref` referencing. */
    schemas?: Record<string, Schema>;
  }

  /**
   * Function metadata with JSON Schema types.
   *
   * @template Schema JSON schema type
   */
  export interface IFunction<
    Schema extends OpenApi.IJsonSchema | OpenApiV3.IJsonSchema =
      OpenApi.IJsonSchema,
  > {
    /** Whether the function is async. */
    async: boolean;

    /** Function name. */
    name: string;

    /** Function parameters. */
    parameters: IParameter<Schema>[];

    /** Return type schema, if any. */
    output: IOutput<Schema> | undefined;

    /** Short summary from JSDoc. */
    summary?: string | undefined;

    /** Full description from JSDoc. */
    description?: string | undefined;

    /** Whether the function is deprecated. */
    deprecated?: boolean;

    /** JSDoc tags. */
    tags?: string[];
  }

  /**
   * Function parameter metadata.
   *
   * @template Schema JSON schema type
   */
  export interface IParameter<
    Schema extends OpenApi.IJsonSchema | OpenApiV3.IJsonSchema =
      OpenApi.IJsonSchema,
  > {
    /** Parameter name. */
    name: string;

    /** Whether the parameter is required. */
    required: boolean;

    /** Parameter type schema. */
    schema: Schema;

    /** Parameter title from JSDoc. */
    title?: string | undefined;

    /** Parameter description from JSDoc. */
    description?: string | undefined;
  }

  /**
   * Function output (return type) metadata.
   *
   * @template Schema JSON schema type
   */
  export interface IOutput<
    Schema extends OpenApi.IJsonSchema | OpenApiV3.IJsonSchema =
      OpenApi.IJsonSchema,
  > {
    /** Return type schema. */
    schema: Schema;

    /** Whether the return value is always present (not void/undefined). */
    required: boolean;

    /** Return value description from JSDoc. */
    description?: string | undefined;
  }
}
